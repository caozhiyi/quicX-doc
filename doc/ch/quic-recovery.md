# QUIC丢失检测与拥塞控制

## 摘要
本文描述了QUIC的丢失检测和拥塞控制机制。   

## 读者须知 
本草案的讨论在QUIC工作组邮件列表中进行(quic@ietf.org)，存档于https://mailarchive.ietf.org/arch/search/？email_list=quic
(https://mailarchive.ietf.org/arch/search/？email_list=quic）。
工作组信息可在https://github.com/quicwg(https://github.com/quicwg)；此草稿的源代码和问题列表可在https://github.com/quicwg/base-drafts/labels//recovery(https://github.com/quicwg/base-drafts/labels//recovery)。

## 版权
版权所有（c）2020 IETF Trust和文件作者。

## 1 介绍
QUIC是一种新的基于UDP的多路复用和安全传输。QUIC建立在几十年的运输和安全经验的基础上，并实施使其作为现代通用通讯协议的机制。   
QUIC实现了现有TCP拥塞控制和丢失恢复机制的机制，在RFCs、各种Internet草稿以及Linux-TCP实现中流行的那些机制。本文档描述了QUIC拥塞控制和丢失恢复，并在适用的情况下，描述了RFC、Internet草稿、学术论文和/或TCP实现中的TCP等效属性。   

## 2 符号约定
关键字 "**一定**", "**禁止**", "**要求**", "**应该**", "**不应**", "**推荐**", "**不推荐**", "**可以**", "**可选**"的使用与[BCP14](https://tools.ietf.org/html/bcp14) [RFC2119](https://tools.ietf.org/html/rfc2119) [RFC8174](https://tools.ietf.org/html/rfc8174)相同。    
本文件中使用的术语定义：
+ ACK引发帧: 除了**ACK**、**PADDING**和**CONNECTION_CLOSE**之外的所有帧都被认为是ACK引发帧。 
+ ACK引发包: 包含ACK引发帧的包在最大ACK延迟内从接收方获取ACK，称为ACK引发包。
+ In-flight: 当ACK引发包或者包含了**PADDING**帧的包发送了但是没有被确认，也没有被确认丢失或者与旧密钥一起被丢弃，则认为是In-flight的。

## 3 QUIC传输机制的设计
QUIC中的所有传输都使用包级别包头发送，该包头指示加密级别并包括包序列号（以下称为包号）。加密级别表示数据包编号空间，如[QUIC-TRANSPORT]中所述。在连接的生命周期内，数据包编号在数据包编号空间内从不重复。包号在一个空间内以单调递增的顺序发送，防止了产生歧义。   
这种设计避免了在传输和重传之间消除歧义的需要，并消除了QUIC解释TCP丢失检测机制的显著复杂性。   
QUIC包可以包含多个不同类型的帧。恢复机制确保需要可靠传输的数据和帧被确认或声明丢失，并在必要时以新的数据包发送。数据包中包含的帧类型影响恢复和拥塞控制逻辑：
+ 所有的包都要被确认，尽管那些不包含ACK引发帧的包只与包含ACK引发帧的包一起被确认。
+ 包含**CRYPTO**帧的长包头数据包对于QUIC握手的性能至关重要，并且使用较短的计时器进行确认。
+ 包含除了**ACK**或**CONNECTION_CLOSE**帧之外的帧的数据包计入拥塞控制限制，并被视为在传输中。
+ **PADDING**帧会导致数据包在传输过程中累加字节，而不会直接导致发送确认。

## 3.1 QUIC与TCP的相关区别
熟悉TCP的丢失检测和拥塞控制的读者会在这里找到与著名的TCP算法类似的算法。然而，QUIC和TCP之间的协议差异导致了算法上的差异。下面我们简要介绍这些协议的差异。  

### 3.1.1 单独的数据包编号空间
QUIC对每个加密级别使用单独的包编号空间，除了0-RTT和所有的1-RTT密钥使用相同的包编号空间。单独的数据包编号空间确保使用一个加密级别发送的数据包的确认不会导致以不同加密级别发送的数据包的虚假重新传输。拥塞控制和往返时间（RTT）测量在包数空间是统一的。   

### 3.1.2 单调递增包数
TCP将发送方的传输指令与接收方的发送指令相混淆，导致相同序列号的数据重发，从而导致“重传模糊”。QUIC把两者分开。QUIC使用数据包编号来指示传输顺序。在一个或多个流中发送应用数据，并且传送顺序由在流帧内编码的流偏移量确定。   
QUIC的包数在一个包数空间内严格递增，并直接根据传输顺序进行编码。较高的数据包编号表示该数据包的发送时间较晚，而较低的数据包编号表示该数据包更早地发送。当检测到包含ACK引发帧的包丢失时，QUIC用新的包号重新处理新包中的必要帧，从而消除在接收ACK时确认哪个包的模糊性。因此，可以进行更精确的RTT测量，可以很容易地检测到虚假的重传，并且诸如快速重传之类的机制可以普遍地应用，而仅仅基于包号。   
这个设计点大大简化了QUIC的丢失检测机制。大多数TCP机制都隐式地尝试根据TCP序列号推断传输顺序—这是一项非常重要的任务，尤其是当TCP时间戳不可用时。   

### 3.1.3 更精确的时间
